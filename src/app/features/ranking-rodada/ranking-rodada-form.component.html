<style>
  .posicao-1 { background-color: #fbbf24 !important; color: #000 !important; } 
  .posicao-2 { background-color: #94a3b8 !important; color: #fff !important; } 
  .posicao-3 { background-color: #b45309 !important; color: #fff !important; } 

  .ranking-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
  .ranking-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4); }
</style>

<div class="relative flex flex-col h-full bg-cover bg-center rounded-lg shadow-lg overflow-hidden"
     style="background-image: url('assets/images/fundobolao.png');">
  
  <div class="absolute inset-0 bg-slate-900/65"></div>

  <div class="relative z-10 p-4 sm:p-6 flex flex-col h-full">
    <div class="flex justify-between items-center mb-4 pb-3 border-b border-gray-400/30">
      <h1 class="font-bold text-white text-lg sm:text-xl">Ranking da Rodada</h1>
      <button mat-raised-button color="primary" (click)="goBack()"
        class="px-3 py-1 text-sm bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-full transition transform hover:scale-105">
        <mat-icon>arrow_back</mat-icon> Voltar
      </button>
    </div>

    <div *ngIf="isLoading" class="flex flex-col items-center justify-center p-8">
      <mat-spinner color="accent" diameter="50"></mat-spinner>
      <p class="mt-4 text-white/80 font-medium">Calculando posições...</p>
    </div>

    <mat-card *ngIf="rankingUsuario && !isLoading" class="bg-slate-800 text-white rounded-xl shadow-2xl p-4 mb-6 border border-indigo-500/40">
      <div class="flex items-center space-x-4">
        <div class="posicao-box rounded-full shadow-lg h-12 w-12 flex items-center justify-center font-bold text-xl" 
             [ngClass]="{'posicao-1': rankingUsuario.posicao === 1, 'posicao-2': rankingUsuario.posicao === 2, 'posicao-3': rankingUsuario.posicao === 3, 'bg-blue-600': rankingUsuario.posicao > 3}">
          {{ rankingUsuario.posicao }}
        </div>
        <div class="flex-grow">
          <p class="text-lg font-black uppercase m-0">{{ rankingUsuario.apelido }}</p>
          <p class="text-xs text-emerald-400 font-bold m-0">{{ rankingUsuario.pontuacao }} PONTOS</p>
        </div>
        <div class="text-right">
          <p *ngIf="pontosAfastado > 0" class="text-base font-black text-rose-500 m-0">- {{ pontosAfastado }}</p>
          <p *ngIf="pontosAfastado === 0" class="text-base font-black text-emerald-400 m-0">LÍDER</p>
          <p class="text-[9px] text-gray-400 uppercase font-black">Distância</p>
        </div>
      </div>
    </mat-card>

    <div *ngIf="!isLoading" class="flex-grow space-y-3 overflow-y-auto pr-1">
      <mat-card *ngFor="let apostador of ranking" 
                class="ranking-card bg-white/95 rounded-xl p-4 transition-all"
                [ngClass]="{'highlighted-user-row bg-indigo-900 text-white border-indigo-500/50 shadow-indigo-600/30': apostador.apostadorId === apostadorLogadoId}">
        <div class="flex items-center space-x-4 p-1">
          <div class="h-10 w-10 flex items-center justify-center rounded-full font-bold shadow-md"
               [ngClass]="{'posicao-1': apostador.posicao === 1, 'posicao-2': apostador.posicao === 2, 'posicao-3': apostador.posicao === 3, 'bg-slate-200 text-slate-700': apostador.posicao > 3 && apostador.apostadorId !== apostadorLogadoId, 'bg-white text-blue-600': apostador.apostadorId === apostadorLogadoId && apostador.posicao > 3}">
            {{ apostador.posicao }}
          </div>
          <div class="flex-grow min-w-0">
            <p class="text-sm font-black truncate uppercase">{{ apostador.apelido }}</p>
            <p class="text-[10px] opacity-70">{{ apostador.dataAtualizacao | date:'dd/MM HH:mm' }}</p>
          </div>
          <div class="text-right">
            <p class="text-lg font-black leading-none" [ngClass]="apostador.apostadorId === apostadorLogadoId ? 'text-white' : 'text-emerald-600'">{{ apostador.pontuacao }}</p>
            <p class="text-[9px] font-bold uppercase opacity-60 m-0">Pontos</p>
          </div>
        </div>
      </mat-card>
    </div>
  </div>
</div>