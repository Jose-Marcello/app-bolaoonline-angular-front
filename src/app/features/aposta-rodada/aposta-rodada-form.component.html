<div class="min-h-screen dashboard-root p-2 sm:p-4" style="background-color: #cbd5e1 !important;">
  <main class="max-w-lg mx-auto space-y-4">

    <div class="card-campeonato-container" style="background-color: #334155 !important; border-radius: 1.5rem; overflow: hidden; border: 1px solid #475569;">
      <div class="card-header-dark" style="background-color: #0f172a !important; padding: 10px 15px;">
        <h2 style="color: #f1f5f9 !important; font-weight: 800 !important; font-size: 10px !important; text-transform: uppercase; margin: 0;">
          1. Selecione a Rodada
        </h2>
      </div>
      <div class="p-3 flex gap-2 overflow-x-auto">
        <button *ngFor="let rodada of rodadasEmAposta" 
                (click)="onRodadaSelected(rodada.id!)"
                [style.background-color]="rodadaSelecionadaId === rodada.id ? '#4f46e5' : '#1e293b'"
                style="min-width: 65px; height: 45px; border-radius: 12px; border: 1px solid #475569; color: white; font-weight: 900; font-size: 12px; cursor: pointer;">
          R{{ rodada.numeroRodada }}
        </button>
      </div>
    </div>

    <div class="card-campeonato-container" style="background-color: #334155 !important; border-radius: 1.5rem; overflow: hidden; border: 1px solid #475569;">
      <div class="card-header-dark" style="background-color: #0f172a !important; padding: 10px 15px;">
        <h2 style="color: #f1f5f9 !important; font-weight: 800 !important; font-size: 10px !important; text-transform: uppercase; margin: 0;">
          2. Suas Apostas nesta Rodada
        </h2>
      </div>
      <div class="p-3 space-y-2">
        <div *ngFor="let aposta of apostasUsuarioRodada" 
             (click)="onApostaSelected(aposta.id!)"
             [style.border-color]="apostaAtual?.id === aposta.id ? '#22c55e' : '#475569'"
             style="background-color: #0f172a; padding: 12px; border-radius: 12px; border: 2px solid; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
          <div class="flex flex-col">
            <span style="color: white; font-weight: 800; font-size: 11px; text-transform: uppercase;">{{ aposta.identificadorAposta }}</span>
            <span style="color: #94a3b8; font-size: 9px; font-weight: 700;">{{ aposta.ehApostaCampeonato ? 'PLANO CAMPEONATO' : 'AVULSA' }}</span>
          </div>
          <mat-icon *ngIf="apostaAtual?.id === aposta.id" style="color: #22c55e;">check_circle</mat-icon>
        </div>

        <button (click)="onClickCriarNovaAposta()" 
                style="width: 100%; padding: 12px; border-radius: 12px; border: 2px dashed #6366f1; background: transparent; color: #818cf8; font-weight: 900; font-size: 10px; text-transform: uppercase; cursor: pointer; margin-top: 5px;">
          + Criar Nova Cartela ({{ custoAposta | currency:'BRL' }})
        </button>
      </div>
    </div>

    <form [formGroup]="apostaForm" class="card-campeonato-container" style="background-color: #334155 !important; border-radius: 1.5rem; overflow: hidden; border: 1px solid #475569;">
      <div class="card-header-dark" style="background-color: #0f172a !important; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center;">
        <h2 style="color: #f1f5f9 !important; font-weight: 800 !important; font-size: 10px !important; text-transform: uppercase; margin: 0;">
          3. {{ isReadOnly ? 'Consulta (Sem Cartela)' : 'Preencher Palpites' }}
        </h2>
        <span [style.background-color]="isReadOnly ? '#f97316' : '#22c55e'" 
              style="color: #000; font-size: 8px; font-weight: 900; padding: 2px 6px; border-radius: 4px; text-transform: uppercase;">
          {{ isReadOnly ? 'Consulta' : 'Edit√°vel' }}
        </span>
      </div>

      <div class="p-3 space-y-3" formArrayName="palpites">
        <div *ngIf="isLoadingPalpites" class="flex justify-center p-4"><mat-spinner diameter="30"></mat-spinner></div>
        
        <div *ngIf="!isLoadingPalpites" class="space-y-3">
          <div *ngFor="let ctrl of palpites.controls; let i = index" [formGroupName]="i"
               style="background-color: #0f172a; padding: 12px; border-radius: 14px; border: 1px solid #1e293b;">
            
            <div style="display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 8px;">
              <div style="text-align: center;">
                <img [src]="jogosDaApostaAtual[i]?.escudoMandante" style="width: 28px; height: 28px; margin: 0 auto 4px;">
                <div style="color: #e2e8f0; font-weight: 800; font-size: 9px; text-transform: uppercase;">{{ jogosDaApostaAtual[i]?.equipeMandante }}</div>
              </div>

              <div style="display: flex; align-items: center; gap: 6px;">
                <input type="number" formControlName="placarApostaCasa"
                       style="width: 42px; height: 42px; background: #f1f5f9; border: none; border-radius: 8px; text-align: center; font-weight: 900; font-size: 18px; color: #0f172a;">
                <span style="color: white; font-weight: 900;">X</span>
                <input type="number" formControlName="placarApostaVisita"
                       style="width: 42px; height: 42px; background: #f1f5f9; border: none; border-radius: 8px; text-align: center; font-weight: 900; font-size: 18px; color: #0f172a;">
              </div>

              <div style="text-align: center;">
                <img [src]="jogosDaApostaAtual[i]?.escudoVisitante" style="width: 28px; height: 28px; margin: 0 auto 4px;">
                <div style="color: #e2e8f0; font-weight: 800; font-size: 9px; text-transform: uppercase;">{{ jogosDaApostaAtual[i]?.equipeVisitante }}</div>
              </div>
            </div>
          </div>
        </div>

        <button *ngIf="!isReadOnly" (click)="salvarApostas()" [disabled]="isSaving"
                style="width: 100%; padding: 16px; border-radius: 1rem; border: none; text-transform: uppercase; background-color: #22c55e !important; color: #000 !important; font-size: 14px !important; font-weight: 900 !important; cursor: pointer; margin-top: 10px;">
          {{ isSaving ? 'Salvando...' : 'Salvar Meus Palpites' }}
        </button>
      </div>
    </form>

    <button (click)="goBackToDashboard()" style="width: 100%; color: #64748b; font-weight: 800; font-size: 10px; text-transform: uppercase; border: none; background: none; padding: 15px; cursor: pointer;">
      < Voltar ao Dashboard
    </button>
  </main>
</div>